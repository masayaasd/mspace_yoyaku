generator client {
  provider   = "prisma-client-js"
  engineType = "library"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum ReservationStatus {
  CONFIRMED
  CANCELLED
  PENDING
}

enum NotificationType {
  REMINDER
}

model PokerTable {
  id           String        @id @default(uuid())
  name         String        @unique
  category     String
  capacityMin  Int
  capacityMax  Int
  isSmoking    Boolean
  displayOrder Int
  reservations Reservation[]
  createdAt    DateTime      @default(now())
  updatedAt    DateTime      @updatedAt
}

model Reservation {
  id            String            @id @default(uuid())
  table         PokerTable        @relation(fields: [tableId], references: [id])
  tableId       String
  customerName  String
  customerPhone String
  lineUserId    String?
  partySize     Int
  startTime     DateTime
  endTime       DateTime
  status        ReservationStatus @default(CONFIRMED)
  notes         String?
  notifications NotificationLog[]
  createdAt     DateTime          @default(now())
  updatedAt     DateTime          @updatedAt

  @@index([tableId, startTime, endTime])
}

model NotificationTemplate {
  id        String           @id @default(uuid())
  type      NotificationType @unique
  title     String
  body      String
  enabled   Boolean          @default(true)
  createdAt DateTime         @default(now())
  updatedAt DateTime         @updatedAt
}

model NotificationLog {
  id            String           @id @default(uuid())
  reservation   Reservation      @relation(fields: [reservationId], references: [id])
  reservationId String
  type          NotificationType
  sentAt        DateTime
  status        String
  errorMessage  String?
  createdAt     DateTime         @default(now())
}

model ConversationState {
  lineUserId String   @id
  context    Json
  updatedAt  DateTime @updatedAt
  createdAt  DateTime @default(now())
}

model SystemSetting {
  key       String   @id
  value     String
  updatedAt DateTime @updatedAt
  createdAt DateTime @default(now())
}

model StaffUser {
  id        String   @id @default(uuid())
  username  String   @unique
  password  String // Hashed
  role      String   @default("ADMIN")
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}
